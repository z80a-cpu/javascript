/**
 * brokanoid ブロカノイド
 * host: (any)
 *
 * キー操作
 *
 * URLパラメタ
 *  s: ステージ
 *  i: tick間隔 初期値: 9
 */
var rt=(m,b,M)=>{if(!b.has(m))throw TypeError("Cannot "+M)};var l=(m,b,M)=>(rt(m,b,"read from private field"),M?M.call(m):b.get(m)),v=(m,b,M)=>{if(b.has(m))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(m):b.set(m,M)},R=(m,b,M,w)=>(rt(m,b,"write to private field"),w?w.call(m,M):b.set(m,M),M);(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))w(f);new MutationObserver(f=>{for(const d of f)if(d.type==="childList")for(const j of d.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&w(j)}).observe(document,{childList:!0,subtree:!0});function M(f){const d={};return f.integrity&&(d.integrity=f.integrity),f.referrerpolicy&&(d.referrerPolicy=f.referrerpolicy),f.crossorigin==="use-credentials"?d.credentials="include":f.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function w(f){if(f.ep)return;f.ep=!0;const d=M(f);fetch(f.href,d)}})();(function(){var J,Q,B,N,y,x,S,k,G,W,I,K,P,T;let m=0,b=0,M=0;const w=12,f=30,d=15,j=9,lt=3,tt=2,q=4,X=1,nt=13,st=7,V=20,Y=7,D=30,E={NORMAL:0,BOUND:1,EDGE:2},ht=80,it=.1,c={IRON:0,BLUE:1,ORANGE:2,GREEN:3,RED:4,PINK:5,KHAKI:6,SPEEDUP:7,SPLIT:8,RAINBOW:9,UPWARD:10,DOWNWARD:11,BARRIER:99},at=["#696969","#87CEFA","#FFA500","#32CD32","#FF4500","#FF69B4","#BDB76B"],O={SPEEDUP:0,SPEEDDOWN:1,WIDE:2,BARRIER:3,SPLIT:4},ct={0:20,1:32,2:25,3:20,4:3},ft=["#FF3927","#FF7A49","#FFC0A9"],Z=[1.3,1.6,2],dt={NORMAL:0,RAINBOW:1},_={0:"ランダム",1:"格子",2:"縦縞",3:"楕円",4:"フェンス",5:"素数",6:"通路",7:"三角",8:"波",9:"上下上",10:"横縞",11:"ビール",12:"スリーピース",13:"円",14:"二重",15:"ハンバーガー",16:"迷路"};class ot{constructor(t,s){v(this,J,void 0);v(this,Q,void 0);R(this,J,t),R(this,Q,s)}static initParams(){let t={};const s=location.search.substring(1).split("&");let e=[];return s.forEach(o=>{const n=o.split("=");e[n[0]]=n[1]}),"s"in e&&(t.s=parseInt(e.s)),"i"in e&&(t.i=parseInt(e.i)),t}static init(){let t="";t='<style type="text/css">.fulloverlay {  position: absolute;  left: 0; top: 0;  width: 100%; height: 100%;  background: rgba(0, 0, 0, 0);  z-index: 20000;}</style><div class="fulloverlay"></div>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<style type="text/css">.info-area-window {  position:fixed;  top:0;  left:0;  display:flex;  justify-content:flex-start;  align-items:start;  width:100vw;  height:100vh;  background-color:rgba(0, 0, 0, 0.7);  backdrop-filter:blur(5px);  z-index:10000;}.info-area-window .content {  border-radius: 4px;  position:relative;  box-sizing:border-box;  margin:5px;  padding:3px;  color:#090815;  background-color:#706D6D;  text-align:right;  font-family:sans-serif;}.info-area-window .content .remaining {  color:#FF0033;  font-weight:bold}</style><div class="info-area-window" id="info-area" aria-hidden="true">  <div class="content">    RB:<span id="clear-blocks">0</span>  </div></div>',document.querySelector("body").insertAdjacentHTML("beforeend",t);const s=location.origin+location.pathname;t='<style type="text/css">.stage-modal {  width:100vw;  height:100vh;  position:fixed;  inset:0;  margin:auto;  display:flex;  visibility:hidden;  align-items: center;  justify-content:center;  z-index:20001;}.stage-modal .content {  border-radius:4px;  position:relative;  box-sizing:border-box;  margin:5px;  padding:5px;  color:#161426;  background-color:#FFFFFF;  text-align:center;  font-family:sans-serif;}.stage-modal .content .header {  margin:5px;  font-size: 1.3em;  font-weight:bold}.stage-modal .content .stage {  display: flex;  justify-content: center;  flex-wrap: wrap;}.stage>div {  width: 49%;  box-sizing: border-box;  border: 1px solid #808080;  margin: 1px;  padding: 3px;  border-radius:4px;}.stage-link>a {  display: block;  text-decoration: none;  padding: 7px;  color: #411445;}.stage-link>a:visited {  color: #411445;  background: #FAEBD7;}.stage-link>a:hover {  color: #411445;}.stage>div:hover {  background: #A7CAA9;}</style><div class="stage-modal" id="stage-modal" aria-hidden="true">  <div class="content">    <div class="header">ステージ選択</div>    <div class="stage">';for(let e=1;e<Object.keys(_).length;e++)t+='      <div class="stage-link">        <a href="'+s+"?s="+e+'">'+e+"."+_[e]+"</a>      </div>";t+='      <div class="stage-link">        <a href="'+s+'?s=0">0.'+_[0]+"</a>      </div>    </div>  </div></div>",document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<style type="text/css">.result-modal {  width:100vw;  height:100vh;  position:fixed;  inset:0;  margin:auto;  display:flex;  visibility:hidden;  align-items: center;  justify-content:center;  z-index:20001;}.result-modal .content {  border-radius:4px;  position:relative;  box-sizing:border-box;  margin:5px;  padding:5px;  color:#161426;  background-color:#FFFFFF;  text-align:center;  font-family:sans-serif;}.result-modal .content .header {  margin:5px;  font-size: 1.5em;  font-weight:bold}.result-modal .content .message {  font-weight: bold;  color: #8B0000;}.result-modal .content td.ttl {  text-align:left;  padding-right:10px;}.result-modal .content td.cl {  color:#484443;  padding-left:15px;}.result-modal .content td.cntt {  text-align:right;}.stage-select {  margin: 10px;}.stage-select>a {  color: #ffffff;  background-color: #eb6100;  border-radius: 4px;  text-decoration: none;  padding: 5px;}.stage-select>a:hover {  color: #ffffff;  background: #CD774F;}.stage-retry {  margin: 10px;}.stage-retry>a {  color: #ffffff;  background-color: #006400;  border-radius: 4px;  text-decoration: none;  padding: 5px;}.stage-retry>a:hover {  color: #ffffff;  background: #2E8B57;}</style><div class="result-modal" id="result-modal" aria-hidden="true">  <div class="content">    <div class="header">brokanoid</div>    <div class="message" id="message"></div>    <div class="stage-retry" id="stage-retry" style="display:none">      <a href="'+location.href+'">リトライ</a>    </div>    <table border="0">      <tr>        <td class="ttl">ステージ</td>        <td class="cntt" id="bstage"></td>      </tr>      <tr>        <td class="ttl">画面サイズ(px)</td>        <td class="cntt" id="bscreen">100x50</td>      </tr>      <tr>        <td class="ttl">経過時間</td>        <td class="cntt" id="belapsed"></td>      </tr>      <tr>        <td class="ttl">クリアブロック</td>        <td class="cntt" id="bclear"></td>      </tr>      <tr>        <td class="ttl">クリア率</td>        <td class="cntt" id="bratio"></td>      </tr>    </table>    <div class="stage-select">      <a href="'+s+'">ステージ選択</a>    </div>  </div></div>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgball" viewbox="0 0 16 16"><g><circle cx="8" cy="8" r="8" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgbar" viewbox="0 0 32 8" preserveAspectRatio="none"><g><rect x="0" y="0" width="32" height="8" rx="3" ry="3" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgblock" viewbox="0 0 32 16" preserveAspectRatio="none"><g><rect x="0" y="0" width="31" height="15" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgblockspeed" viewbox="0 0 32 16" preserveAspectRatio="none"><g><rect x="0" y="0" width="31" height="15" fill="#1E90FF" /><path d="M 15 2 L 24 13 L 6 13 z" fill="#AFEEEE" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgblocksplit" viewbox="0 0 32 16" preserveAspectRatio="none"><g><rect x="0" y="0" width="31" height="15" fill="#b49e46" /><circle cx="23" cy="8" r="3" fill="#ebe5cf" /><circle cx="9" cy="8" r="3" fill="#ebe5cf" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:hidden;"><defs><linearGradient id="gradient" gradientUnits="userSpaceOnUse"x1="0" y1="0" x2="31" y2="15"><stop offset="0.14" stop-color="#ff0000"/><stop offset="0.28" stop-color="#ffa500"/><stop offset="0.42" stop-color="#ffff00"/><stop offset="0.56" stop-color="#008000"/><stop offset="0.70" stop-color="#00ffff"/><stop offset="0.84" stop-color="#0000ff"/><stop offset="1.00" stop-color="#800080"/></linearGradient><symbol id="orgblockrainbow" viewbox="0 0 32 16" preserveAspectRatio="none"><g fill="url(#gradient)"><rect x="0" y="0" width="31" height="15" /></g></symbol></defs></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgblockupward" viewbox="0 0 32 16" preserveAspectRatio="none"><g><rect x="0" y="0" width="31" height="15" stroke="#778899" /><path d="M 15 2 L 24 13 L 6 13 z" stroke="#778899" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgblockdownfard" viewbox="0 0 32 16" preserveAspectRatio="none"><g><rect x="0" y="0" width="31" height="15" stroke="#778899" /><path d="M 15 13 L 6 2 L 24 2 z" stroke="#778899" /></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgitemup" viewbox="0 0 32 32" preserveAspectRatio="none"><g><circle cx="16" cy="16" r="15" fill="#1E90FF" /><text x="16" y="27" font-size="28" text-anchor="middle" fill="#FFFFE0" font-weight="bold">U</text></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgitemdown" viewbox="0 0 32 32" preserveAspectRatio="none"><g><circle cx="16" cy="16" r="15" fill="#483d8b" /><text x="16" y="26" font-size="27" text-anchor="middle" fill="#B0E0E6" font-weight="bold">D</text></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgitemwide" viewbox="0 0 32 32" preserveAspectRatio="none"><g><circle cx="16" cy="16" r="15" fill="#2E8B57" /><text x="16" y="26" font-size="25" text-anchor="middle" fill="#ADFF2F" font-weight="bold">W</text></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgitembarrier" viewbox="0 0 32 32" preserveAspectRatio="none"><g><circle cx="16" cy="16" r="15" fill="#fd0102" /><text x="16" y="26" font-size="27" text-anchor="middle" fill="#FFFFE0" font-weight="bold">B</text></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t),t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;"><symbol id="orgitemsplit" viewbox="0 0 32 32" preserveAspectRatio="none"><g><circle cx="16" cy="16" r="15" fill="#b49e46" /><text x="16" y="26" font-size="27" text-anchor="middle" fill="#FFFFE0" font-weight="bold">S</text></g></symbol></svg>',document.querySelector("body").insertAdjacentHTML("beforeend",t)}}J=new WeakMap,Q=new WeakMap;class yt{constructor(){v(this,B,void 0);v(this,N,void 0);v(this,y,void 0);v(this,x,void 0);v(this,S,0);v(this,k,void 0);R(this,B,document.documentElement.clientWidth),R(this,N,document.documentElement.clientHeight),R(this,y,Math.floor(l(this,B)/f)),R(this,x,Math.floor(l(this,N)/d)),R(this,k,ot.initParams()),ot.init(l(this,B),l(this,N)),this.startTime=new Date}start(){if(l(this,k).s===void 0){const t=document.getElementById("stage-modal");t.style.visibility="visible"}else{console.log("*** ゲームスタート ***"),this.field=new gt(l(this,B),l(this,N)),this.stage(),this.field.bar=new pt(l(this,B),l(this,N)),this.field.balls.push(new et(this.field.bar.x+this.field.bar.w/2,this.field.bar.cy-this.field.bar.h)),this.setKeyEvent(),this.setMouseEvent(),this.setTouchEvent();const t=l(this,k).i===void 0?j:l(this,k).i;this.timer=setInterval(()=>this.tick(),t)}}stage(){switch(l(this,k).s){case 0:this.stageRandom();break;case 1:this.stageLattice();break;case 2:this.stageVerticalStripe();break;case 3:this.stageEllipse();break;case 4:this.stageFence();break;case 5:this.stagePrimeNumber();break;case 6:this.stagePassage();break;case 7:this.stageTriangle();break;case 8:this.stageSineWave();break;case 9:this.stageUpDown();break;case 10:this.stageHorizontalStripe();break;case 11:this.stageBeer();break;case 12:this.stageThreePieces();break;case 13:this.stageCircle();break;case 14:this.stageDoubleFence();break;case 15:this.stageHamburger();break;case 16:this.stageMaze();break}R(this,S,this.field.blocks.filter(t=>t.type!==c.IRON).length)}stageRandom(){const t={NONE:20.7,IRON:3,RANDOM:72,SPEEDUP:1,SPLIT:1,RAINBOW:.3,UPWARD:1,DOWNWARD:1},s=0,e=3;let o=l(this,y)-s+1,n=Math.floor(l(this,x)*.6)-e,i=[];for(let r=0;r<=n;r++){let a=[];for(let h=0;h<o;h++)a.push(null);i.push(a)}for(let r=e;r<n;r++)for(let a=s;a<o;a++){let h=null;if(a===o-1)h=c.IRON;else{const p=Math.random()*100;let u=0;for(const[A,L]of Object.entries(t)){if(u<=p&&p<u+L){A==="NONE"?h=null:A==="RANDOM"?h=Math.floor(Math.random()*6)+1:h=c[A];break}u+=L}}i[r][a]=h}if(Math.random()*100<70){const r=Math.floor(o/3*(Math.floor(Math.random()*2)+1)),a=3;let h=Math.floor(Math.random()*3);for(let p=e;p<n;p++)for(let u=0;u<a;u++){let A=null;(h===1||h===2)&&p%4===0&&(h===1?A=c.UPWARD:h===2&&(A=c.DOWNWARD)),i[p][r+u]=A}}for(let r=e;r<n;r++)for(let a=s;a<o;a++)i[r][a]!==null&&this.field.blocks.push(new g(a*f,r*d,i[r][a],f,d))}stageLattice(){const t=Math.floor(l(this,y)*.2),s=Math.floor(l(this,x)*.2);let e=Math.floor(l(this,y)*.6),o=Math.floor(l(this,x)*.3);e=e%2===0?e:e-1,o=o%2===0?o:o-1;for(let n=0;n<=o;n++)for(let i=0;i<=e;i++){if(i%2===0&&n%2===0)continue;const r=Math.floor(Math.random()*6)+1;this.field.blocks.push(new g((t+i)*f,(s+n)*d,r,f,d))}}stageEllipse(){const t=Math.floor(l(this,y)*.4),s=Math.floor(l(this,x)*.2),e=Math.floor(l(this,y)*.5),o=Math.floor(l(this,x)*.3);for(let n=0;n<l(this,x);n++)for(let i=0;i<l(this,y);i++){const r=i-e,a=n-o;if(r*r/(t*t)+a*a/(s*s)<=1){const h=n===o&&i%2===0&&Math.abs(r)!==t?c.SPLIT:n%6+1;this.field.blocks.push(new g(i*f,n*d,h,f,d))}}}stageThreePieces(){for(let t=Math.floor(l(this,x)*.1);t<Math.floor(l(this,x)*.6);t+=4)for(let s=Math.floor(l(this,y)*.1);s<Math.floor(l(this,y)*.9);s+=4)for(let e=t;e<t+3;e++){let o=e%6+1;e===t&&Math.random()*12<1&&(o=c.IRON);for(let n=s;n<s+3&&n<l(this,y);n++)this.field.blocks.push(new g(n*f,e*d,o,f,d))}}stageTriangle(){const t=Math.floor(l(this,x)*.1);let s=0;for(let e=3;e<Math.floor(l(this,x)*.5);e+=t+1)for(let o=1;o<l(this,y);o+=t+1){let n=s%6+1;s++,Math.random()*100<7&&(n=c.IRON);const i=Math.random()*100<8;for(let r=0;r<t;r++)for(let a=0;a<r+1&&o+a<l(this,y);a++){let h=n;n!==c.IRON&&a===1&&r===2&&i&&(h=Math.floor(Math.random()*5)+7),this.field.blocks.push(new g((o+a)*f,(e+r)*d,h,f,d))}}}stageBeer(){for(let t=5;t<Math.floor(l(this,x)*.7);t++)for(let s=2;s<l(this,y)-5;s++)if(s===2||s===l(this,y)-6||t===Math.floor(l(this,x)*.7)-1)this.field.blocks.push(new g(s*f,t*d,c.IRON,f,d));else if(t===7)this.field.blocks.push(new g(s*f,t*d,c.DOWNWARD,f,d));else if(t===8||t===9)this.field.blocks.push(new g(s*f,t*d,c.SPLIT,f,d));else if(t>=10){const e=(s+t)%2?c.ORANGE:c.KHAKI;this.field.blocks.push(new g(s*f,t*d,e,f,d))}for(let t=Math.floor(l(this,x)*.2);t<Math.floor(l(this,x)*.5);t++)for(let s=l(this,y)-5;s<l(this,y)-3;s++)(s===l(this,y)-4|t===Math.floor(l(this,x)*.2)||t===Math.floor(l(this,x)*.5)-1)&&this.field.blocks.push(new g(s*f,t*d,c.IRON,f,d))}stageVerticalStripe(){for(let t=5;t<Math.floor(l(this,x)*.6);t++)for(let s=0;s<l(this,y);s+=2){const e=s/2%5+1;this.field.blocks.push(new g(s*f,t*d,e,f,d))}Math.floor(l(this,y)*.5);for(let t=1;t<l(this,y);t+=2){const s=Math.random()*100;let e=c.KHAKI;s<3?e=c.RAINBOW:s<10?e=c.SPLIT:s<15&&(e=c.SPEEDUP),this.field.blocks.push(new g(t*f,Math.floor(l(this,x)*.3)*d,e,f,d))}}stageHorizontalStripe(){for(let t=5;t<Math.floor(l(this,x)*.5);t+=3)for(let s=0;s<l(this,y);s++){let e=Math.floor(t/2%6)+1;if(s%Math.floor(l(this,y)/4)===0){const o=Math.random()*100;if(o<3)e=c.RAINBOW;else if(o<10)e=c.SPLIT;else if(o<15)e=c.SPEEDUP;else continue}this.field.blocks.push(new g(s*f,t*d,e,f,d))}}stageFence(){let t=Math.floor(l(this,y)*.8);for(let i=0;i<Math.floor(l(this,x)*.6);i++)Math.floor(l(this,x)*.2)<=i&&i<=Math.floor(l(this,x)*.2)+1||Math.floor(l(this,x)*.4)<=i&&i<=Math.floor(l(this,x)*.4)+1||this.field.blocks.push(new g(t*f,i*d,c.IRON,f,d));for(let i=0;i<=Math.floor(l(this,y)*.8);i++){const r=Math.floor(l(this,x)*.6);this.field.blocks.push(new g(i*f,r*d,c.IRON,f,d))}const s=Math.floor(l(this,y)*.3),e=Math.floor(l(this,x)*.2),o=Math.floor(l(this,y)*.4)-2,n=Math.floor(l(this,x)*.3);for(let i=0;i<Math.floor(l(this,x)*.6);i++)for(let r=0;r<Math.floor(l(this,y)*.8);r++){const a=r-o,h=i-n;if(a*a/(s*s)+h*h/(e*e)<=1){let p=i===n?c.SPLIT:i%6+1;p=r===Math.floor(l(this,y)*.4)-2?c.SPEEDUP:p,this.field.blocks.push(new g(r*f,i*d,p,f,d))}}}stageCircle(){let s=0;for(let e=2;e<=Math.floor(l(this,x)*.5);e+=4*2+1)for(let o=0;o<l(this,y);o+=4*2+1){s++;for(let n=0;n<4*2;n++)for(let i=0;i<4*2&&o+i<l(this,y);i++){const r=i-4,a=n-4;if(r*r/(4*4)+a*a/(4*4)<=1){let h=s%6+1;if(i===4&&n===4){const p=Math.random()*100;if(p<3)h=c.RAINBOW;else if(p<23)h=c.IRON;else if(p<33)h=c.SPLIT;else if(p<43)h=c.SPEEDUP;else continue}this.field.blocks.push(new g((o+i)*f,(e+n)*d,h,f,d))}}}}stageSineWave(){let t=Math.PI/2;for(let s=0;s<l(this,y);s++){let e=10*Math.sin(s*(Math.PI*2/16));e=Math.floor(l(this,x)*.35+e);for(let o=0;o<6;o++){if(e-o<0)continue;let n=o+1;if(s*(Math.PI*2/16)>=t&&o===5){t+=Math.PI;const i=Math.random()*100;i<5?n=c.RAINBOW:i<45?n=c.SPLIT:n=c.SPEEDUP}this.field.blocks.push(new g(s*f,(e-o)*d,n,f,d))}}}stageDoubleFence(){let t=Math.floor(l(this,y)*.8),s=Math.floor(l(this,x)*.5),e=Math.floor(l(this,y)*.5)-Math.floor(t/2),o=3,n=Math.floor(Math.random()*6);for(let i=0;i<3;i++){i>0&&(t-=4,s-=4,e+=2,o+=2),n++;for(let r=0;r<t;r++)for(let a=1;a<s;a++)if(r===0||r===t-1||a===1||a===s-1||i===2){if(i===2&&(r+a)%2===0)continue;i===2&&n++;let h=n%6+1;i===1&&a===s-1&&0<r&&r<t-1&&r%2===0&&(h=c.UPWARD),this.field.blocks.push(new g((e+r)*f,(o+a)*d,h,f,d))}}}stagePrimeNumber(){let t=Math.floor(Math.random()*6);for(let s=0;s<Math.floor(l(this,x)*.5);s++)for(let e=0;e<Math.floor(l(this,y));e++){let o=!0;const n=s*l(this,y)+e+1;if(n===1)o=!1;else for(let i=2;i<n;i++)if(n%i===0){o=!1;break}if(o){t++;const i=t%6+1;this.field.blocks.push(new g(e*f,(s+3)*d,i,f,d))}else if(Math.random()*100<1){const i=c.IRON;this.field.blocks.push(new g(e*f,(s+3)*d,i,f,d))}}}stagePassage(){const t=Math.floor(l(this,x)*.5/3);let s=[],e;for(let i=0;i<3;i++){const r=Math.floor(l(this,x)*.5)-i*t;s.push(r);for(let a=0;a<l(this,y);a++)i===2&&a<2?e=c.DOWNWARD:i===2&&a>l(this,y)-3?e=c.UPWARD:i===0&&a>l(this,y)-4?e=Math.floor(Math.random()*6)+1:i===1&&a<2?e=c.SPLIT:e=c.IRON,this.field.blocks.push(new g(a*f,r*d,e,f,d))}this.field.blocks.push(new g(l(this,y)*f,(Math.floor(l(this,x)*.5)-1*t)*d,c.IRON,f,d));let o=Math.floor(l(this,y)*.5);for(let i=Math.floor(l(this,x)*.5)-2*t;i<Math.floor(l(this,x)*.5);i++)s.includes(i)||(e=Math.floor(Math.random()*6)+1,this.field.blocks.push(new g(o*f,i*d,e,f,d)));const n=Math.floor(l(this,x)*.5)-2*t;for(let i=0;i<3;i++){let r=Math.floor(n*.5)-1+i;if(!(r>=n))for(let a=0;a<3;a++){let h=Math.floor(l(this,y)*.5)-1+a;e=Math.floor(Math.random()*6)+1,this.field.blocks.push(new g(h*f,r*d,e,f,d))}}}stageHamburger(){let t;const s=Math.floor(l(this,y)*.2),e=Math.floor(l(this,y)*.8),o=5,n=Math.floor(l(this,x)*.5),i=n-o-2;let r=0;for(let a=o;a<=n;a++){r=(e-s)%2===1?r+1:r;for(let h=s;h<=e;h++){if(a===o||a===n){if(a===o||h<=s+1||e-1<=h)continue;t=c.IRON}else if(a<=o+Math.floor(i*.2)||n-Math.floor(i*.2)<=a&&a<=n-1){if((o+1===a||n-1===a)&&(h<=s+1||e-1<=h))continue;o+2===a&&h%3===1?t=c.SPLIT:t=c.KHAKI}else a<=o+Math.floor(i*.3)||n-Math.floor(i*.3)<=a&&a<n-Math.floor(i*.2)?t=c.GREEN:a<=o+Math.floor(i*.35)||n-Math.floor(i*.35)<=a&&a<n-Math.floor(i*.3)?t=c.RED:(r++,a===o+Math.floor(i*.35)+1&&(h===s+Math.floor(l(this,y)*.2)||h===s+Math.floor(l(this,y)*.4))?t=c.RAINBOW:t=r%2===0?c.ORANGE:c.PINK);this.field.blocks.push(new g(h*f,a*d,t,f,d))}}}stageMaze(){let e=l(this,y)-1,o=Math.floor(l(this,x)*.6)-4;e=e%2===0?e:e-1,o=o%2===0?o:o-1;let n=[];for(let i=0;i<=o;i++){let r=[];for(let a=0;a<=e+1;a++)r.push(null);n.push(r)}for(let i=0;i<=o;i++)for(let r=0;r<=e+1;r++)i===0&&(r%10===1&&r<e||r===e-1)||(i===o&&(r%6===1&&r<e||r===e-1)?n[i][r]=c.UPWARD:(i===0||i===o||r===0||r>=e||i%2===0&&r%2===0)&&(n[i][r]=c.IRON));for(let i=2;i<o;i+=2)for(let r=2;r<e;r+=2)for(;;){let a;r===2?a=Math.floor(Math.random()*4):a=Math.floor(Math.random()*3);let h,p;if(a===0?(h=r,p=i-1):a===1?(h=r+1,p=i):a===2?(h=r,p=i+1):a===3&&(h=r-1,p=i),n[p][h]===null){n[p][h]=c.IRON;break}}for(let i=2;i<o;i+=2)for(let r=1;r<e;r+=2)Math.random()*10<3&&(n[i][r]=null);for(let i=1;i<o;i+=2)for(let r=2;r<e;r+=2)Math.random()*10<1&&(n[i][r]=null);for(let i=1;i<=o;i++)for(let r=1;r<=e+1;r++)if(n[i][r]===null){const a=Math.random()*100;a<.5?n[i][r]=c.RAINBOW:a<3.5?n[i][r]=c.SPLIT:a<4.5?n[i][r]=c.SPEEDUP:a<19.5&&(n[i][r]=Math.floor(Math.random()*6)+1)}for(let i=0;i<=o;i++)for(let r=0;r<=e+1;r++)n[i][r]!==null&&this.field.blocks.push(new g((1+r)*f,(4+i)*d,n[i][r],f,d));this.field.blocks.push(new g(0*f,(4+o)*d,c.DOWNWARD,f,d))}stageUpDown(){const t=Math.floor(Math.random()*2)+3,s=5,e=0,o=l(this,y),n=4,i=Math.floor(l(this,x)*.5),r=Math.floor((o-e)/2-t/2);for(let a=0;a<=i-n;a++)for(let h=0;h<=o;h++){if((0<=h&&h<0+t||o-t<h&&h<=o)&&a%s===0){const p=c.UPWARD;this.field.blocks.push(new g((e+h)*f,(n+a)*d,p,f,d))}if(r<=h&&h<r+t&&a%s===0){const p=c.DOWNWARD;this.field.blocks.push(new g((e+h)*f,(n+a)*d,p,f,d))}if(0+t<=h&&h<r||r+t<=h&&h<=o-t){let p=null;if(h===t+Math.floor((r-t)*.5)&&a===Math.floor((i-n)*.4)?p=c.SPLIT:h===r+t+Math.floor((o-t-r-t)*.5)&&a===Math.floor((i-n)*.4)&&(p=c.RAINBOW),p===null&&Math.random()*13<1)continue;p===null&&(p=Math.floor(Math.random()*6)+1),this.field.blocks.push(new g((e+h)*f,(n+a)*d,p,f,d))}}}tick(){this.field.balls.forEach(e=>{[e.exist,e.angle,e.x,e.y,e.speed,e.type]=this.field.collide(e),e.draw()}),this.field.balls=this.field.balls.filter(function(e){return e.exist||e.remove(),e.exist});const t=this.field.blocks.filter(function(e){return e.type!==c.IRON&&e.type!==c.BARRIER&&e.type!==c.UPWARD&&e.type!==c.DOWNWARD}).length,s=document.getElementById("clear-blocks");s.textContent=t.toLocaleString(),t/l(this,S)<=it&&s.classList.add("remaining"),t<=0&&this.gameOver(!0,!1),this.field.balls.length<=0&&this.gameOver(!1,!1),this.field.items.forEach(e=>{[e.exist,e.y]=this.field.collideItem(e),e.draw()}),this.field.items=this.field.items.filter(function(e){return e.exist||e.remove(),e.exist})}gameOver(t=!0,s=!1){clearInterval(this.timer),console.log(s?"*** ギブアップ ***":t?"*** クリア ***":"*** ゲームオーバー ***");const e=new Date,o=parseInt((e.getTime()-this.startTime.getTime())/1e3),n=parseInt(o/3600),i=parseInt(o/60%60),r=o%60,a=n+":"+("00"+i).slice(-2)+":"+("00"+r).slice(-2),h=l(this,B)+"x"+l(this,N),p=l(this,S),u=this.field.blocks.filter(function(H){return H.type!==c.IRON&&H.type!==c.BARRIER&&H.type!==c.UPWARD&&H.type!==c.DOWNWARD}).length,A=p-u,L=A.toLocaleString()+"/"+p.toLocaleString(),F=Math.floor(A/p*100)+"%";console.log("ステージ:"+l(this,k).s+"."+_[l(this,k).s]),console.log("経過時間:"+a),console.log("クリアブロック:"+L),console.log("クリア率:"+F+"%");const z=l(this,k).s+"."+_[l(this,k).s];document.getElementById("bscreen").textContent=h,document.getElementById("belapsed").textContent=a,document.getElementById("bclear").textContent=L,document.getElementById("bstage").textContent=z,document.getElementById("bratio").textContent=F;const U=document.getElementById("message");t?U.textContent="クリア！":s?(U.textContent="ギブアップ",document.getElementById("stage-retry").style.display="inline-block"):t===!1&&s===!1&&(U.textContent="失敗",document.getElementById("stage-retry").style.display="inline-block");const $=document.getElementById("result-modal");$.style.visibility="visible"}setKeyEvent(){document.onkeydown=function(t){switch(t.keyCode){case 37:this.field.bar.move(-1);break;case 39:this.field.bar.move(1);break;case 71:this.gameOver(!1,!0);break;case 84:this.tilt();break;case 85:this.speedup();break}}.bind(this)}tilt(){console.log("Tilt!"),this.field.balls.forEach(t=>{let s=t.angle;const e=Math.floor(s/90)*90,o=e+D,n=e+90-D,i=Math.floor(Math.random()*3)+3;let r=Math.floor(Math.random()*2)<1?i*-1:i;r=s+r<o?r*-1:r,r=s+r>n?r*-1:r,t.angle=s+r})}speedup(){this.field.balls.forEach(t=>{t.speed<q&&(t.speed+=X)}),console.log("スピードアップ(手動)")}setMouseEvent(){document.body.addEventListener("mousemove",t=>{const s=t.pageX;this.field.bar.moveDirect(s)},!1),document.body.addEventListener("mousedown",t=>{this.field.blocks.filter(function(e){return e.type!==c.IRON&&e.type!==c.BARRIER&&e.type!==c.UPWARD&&e.type!==c.DOWNWARD}).length/l(this,S)<=it&&this.field.balls.forEach(e=>{e.reverse(),e.draw()})},!1)}setTouchEvent(){document.body.addEventListener("touchmove",t=>{const s=t.changedTouches;for(let e=0;e<s.length;e++){const o=s[e].clientX;this.field.bar.moveDirect(o)}},!1),document.body.addEventListener("touchstart",t=>{const s=t.changedTouches;for(let e=0;e<s.length;e++){const o=s[e].clientX,n=s[e].clientY;o<l(this,B)*.2&&n<l(this,N)*.1&&this.gameOver(!1,!0)}},!1)}}B=new WeakMap,N=new WeakMap,y=new WeakMap,x=new WeakMap,S=new WeakMap,k=new WeakMap;class g{constructor(t,s,e,o,n,i=0){this.x=t,this.y=s,this.type=e,this.w=o,this.h=n,this.type==c.IRON||this.type==c.UPWARD||this.type==c.DOWNWARD?this.durability=-1:this.durability=1,this.exist=!0,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,b++,b=b>9999999999?1:b,this.id=("0000000000"+b).slice(-10),this.type<7?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; fill: "+at[this.type]+"; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblock"></use></svg>'):this.type===c.SPEEDUP?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblockspeed"></use></svg>'):this.type===c.SPLIT?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblocksplit"></use></svg>'):this.type===c.RAINBOW?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblockrainbow"></use></svg>'):this.type===c.BARRIER?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; fill: "+ft[i]+"; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblock"></use></svg>'):this.type===c.UPWARD?document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblockupward"></use></svg>'):this.type===c.DOWNWARD&&document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="block-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10002; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#orgblockdownfard"></use></svg>'),this.svg=document.getElementById("block-"+this.id)}remove(){this.svg.remove()}}class et{constructor(t,s,e=315,o=0){v(this,G,["#ff0000","#ffa500","#ffff00","#00ffff","#0000ff","#800080"]);v(this,W,0);m++,m=m>9999999999?1:m,this.id=("0000000000"+m).slice(-10),document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="ball-'+this.id+'" viewBox="0 0 '+w+" "+w+'" style="width: '+w+"px; height: "+w+'px; opacity: 1; position: fixed; z-index: 10002; display: none;"><use xlink:href="#orgball"></use></svg>'),this.svg=document.getElementById("ball-"+this.id),this.exist=!0,this.type=o,this.svg.style.fill="#FFFFFF",this.x=t,this.y=s,this.iron=!1,this.angle=e,this.speed=lt}move(){this.x+=this.speed*Math.cos(this.angle*(Math.PI/180)),this.y+=this.speed*Math.sin(this.angle*(Math.PI/180))}reverse(){0<=this.angle&&this.angle<90?this.angle=360-(this.angle-0):90<=this.angle&&this.angle<180?this.angle=270-(this.angle-90):180<=this.angle&&this.angle<270?this.angle=180-(this.angle-180):270<=this.angle&&this.angle<360&&(this.angle=0+(this.angle-270))}draw(){this.type===1&&(R(this,W,l(this,W)<l(this,G).length?l(this,W)+1:0),this.svg.style.fill=l(this,G)[l(this,W)]);const t=Math.floor(this.x-w/2),s=Math.floor(this.y-w/2);this.svg.style.left=t+"px",this.svg.style.top=s+"px",this.svg.style.display=="none"&&(this.svg.style.display="inline-block")}remove(){this.svg.remove()}}G=new WeakMap,W=new WeakMap;class pt{constructor(t,s,e=null,o=10){v(this,I,void 0);v(this,K,void 0);R(this,I,t),R(this,K,s),this.w=e===null?Math.floor(l(this,I)/10):e,this.w=this.w<70?70:this.w,this.w=this.w>130?130:this.w,this.ow=this.w,this.h=o,this.mag=1,this.x=l(this,I)/2-this.w/2,this.y=l(this,K)-ht,this.center(),document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="bar" viewBox="0 0 '+this.w+" "+this.h+'" style="width: '+this.w+"px; height: "+this.h+"px; opacity: 1; position: fixed; z-index: 10002; left: "+Math.floor(this.x)+"px; top: "+Math.floor(this.y)+'px; display: inline-block;" preserveAspectRatio="none"><use xlink:href="#orgbar"></use></svg>'),this.svg=document.getElementById("bar"),this.setColor(E.NORMAL)}setColor(t=E.NORMAL){let s;switch(t){case E.NORMAL:s="#DCDCDC";break;case E.BOUND:s="#e8a7ca";break;case E.EDGE:s="#ff3366";break}this.svg.style.fill=s}move(t){this.setColor(E.NORMAL);let s=this.x+t*Math.floor(this.w/2);s=s<0?l(this,I)-this.w:s,s=s>=l(this,I)-this.w/2?0:s,this.x=s,this.center(),this.svg.style.left=s}moveDirect(t){this.setColor(E.NORMAL),t=Math.floor(t-this.w/2),t=t<t-this.w?t-this.w:t,t=t>=l(this,I)?l(this,I):t,this.x=t,this.center(),this.svg.style.left=this.x}center(){this.cx=this.x+this.w/2,this.cy=this.y+this.h/2}wide(t){this.mag=t,this.w=this.ow*t;let s=this.x;s<this.w/2?s=0:l(this,I)-this.w<s?s=l(this,I)-this.w:s=this.cx-this.w/2,this.x=s,this.svg.style.width=this.w,this.svg.style.left=this.x,this.center()}}I=new WeakMap,K=new WeakMap;class xt{constructor(t,s,e,o,n){this.x=t,this.y=s,this.type=parseInt(e),this.w=o,this.h=n,this.speed=1,this.exist=!0,this.center(),M++,M=M>9999999999?1:M,this.id=("0000000000"+M).slice(-10);let i;switch(this.type){case O.SPEEDUP:i="orgitemup";break;case O.SPEEDDOWN:i="orgitemdown";break;case O.WIDE:i="orgitemwide";break;case O.BARRIER:i="orgitembarrier";break;case O.SPLIT:i="orgitemsplit";break}document.querySelector("body").insertAdjacentHTML("beforeend",'<svg id="item-'+this.id+'" viewBox="0 0 '+o+" "+n+'" style="width: '+o+"px; height: "+n+"px; opacity: 1; position: fixed; z-index: 10010; left: "+this.x+"px; top: "+this.y+'px; display: inline-block;"><use xlink:href="#'+i+'"></use></svg>'),this.svg=document.getElementById("item-"+this.id)}move(){this.y+=this.speed}center(){this.cx=this.x+this.w/2,this.cy=this.y+this.h/2}draw(){this.svg.style.top=this.y}remove(){this.svg.remove()}}class gt{constructor(t,s){v(this,P,void 0);v(this,T,void 0);R(this,P,t),R(this,T,s),this.balls=[],this.blocks=[],this.items=[],this.bar}collide(t){let s=!0,e=t.angle,o=t.x,n=t.y,i=t.speed,r=t.type;const a=o+i*Math.cos(e*(Math.PI/180)),h=n+i*Math.sin(e*(Math.PI/180)),p=a+w/2*Math.cos(e*(Math.PI/180)),u=h+w/2*Math.sin(e*(Math.PI/180));return p<=0||p>=l(this,P)-1||u<=0||u>=l(this,T)-1?[s,e]=this.reflectWall(e,p,u):this.bar.x<=p&&p<=this.bar.x+this.bar.w&&this.bar.y<=u&&u<=this.bar.y+this.bar.h?e=this.reflectBar(e,p,u):[e,o,n,i,r]=this.reflectBlock(e,o,n,i,r),e=e<=0?e+360:e,e=e%360,[s,e,o,n,i,r]}reflectWall(t,s,e){let o=!0;return s<=0?t=0-(t-180):s>=l(this,P)-1?t=180-(t>=180?t-360:t):e<=0?t=90-(t-270):e>=l(this,T)-1&&(t=270-(t-90),o=!1),[o,t]}reflectBar(t,s,e){return 0<=t&&t<90?s<=this.bar.x+this.bar.w*(st/100)?(t+=180,this.bar.setColor(E.EDGE)):(t=270+(90-t),s<=this.bar.x+this.bar.w*(V/100)?(t-=Y*2,t=t<270+D?270+D:t,this.bar.setColor(E.BOUND)):this.bar.x+this.bar.w*((100-V)/100)<=s&&(t+=Y,this.bar.setColor(E.BOUND),t=t>360-D?360-D:t)):90<=t&&t<180&&(this.bar.x+this.bar.w*((100-st)/100)<=s?(t+=180,this.bar.setColor(E.EDGE)):(t=270-(t-90),s<=this.bar.x+this.bar.w*(V/100)?(t-=Y,t=t<180+D?180+D:t,this.bar.setColor(E.BOUND)):this.bar.x+this.bar.w*((100-V)/100)<=s&&(t+=Y*2,t=t>270-D?270-D:t,this.bar.setColor(E.BOUND)))),t}reflectBlock(t,s,e,o,n){let i=!1,r,a;for(let h=1;h<=o&&(r=s+h*Math.cos(t*(Math.PI/180)),a=e+h*Math.sin(t*(Math.PI/180)),[i,t,s,e,o,n]=this.reflectBlockSec(t,r,a,o,n),!i);h++);return[t,s,e,o,n]}reflectBlockSec(t,s,e,o,n){let r=!1,a=t;return this.blocks.forEach(h=>{let p=Math.floor(t/90)*90;for(let u=p;u<=p+90;u+=45){const A=s+w/2*Math.cos(u*(Math.PI/180)),L=e+w/2*Math.sin(u*(Math.PI/180));if(h.x<=A&&A<=h.x+h.w&&h.y<=L&&L<=h.y+h.h){r=!0;const F=Math.abs(s-h.cx),z=Math.abs(e-h.cy);if(0<=t&&t<90&&F>=(h.w*.5+w*.5)*.85&&z<=h.h*.5?t=h.type===c.DOWNWARD?a:180-t:0<=t&&t<90?t=h.type===c.DOWNWARD?a:360-t:90<=t&&t<180&&F>=(h.w*.5+w*.5)*.85&&z<=h.h*.5?t=h.type===c.DOWNWARD?a:0+(180-t):90<=t&&t<180?t=h.type===c.DOWNWARD?a:270-(t-90):180<=t&&t<270&&F>=(h.w*.5+w*.5)*.85&&z<=h.h*.5?t=h.type===c.UPWARD?a:360-(t-180):180<=t&&t<270?t=h.type===c.UPWARD?a:270-t+90:270<=t&&t<360&&F>=(h.w*.5+w*.5)*.85&&z<=h.h*.5?t=h.type===c.UPWARD?a:180+(360-t):270<=t&&t<360&&(t=h.type===c.UPWARD?a:360-t),0<h.durability&&(h.durability--,h.durability<=0&&(h.exist=!1)),n===dt.RAINBOW&&h.type!==c.IRON&&h.type!==c.UPWARD&&h.type!==c.DOWNWARD&&h.type!==c.BARRIER&&(t=a),h.type===c.RAINBOW&&(n=1),h.type===c.SPEEDUP&&o<q&&(o+=X),h.type===c.SPLIT&&this.balls.push(new et(h.cx,h.cy,a)),c.BLUE<=h.type&&h.type<=c.KHAKI&&Math.random()*nt<1){const U=Math.floor(f*.7);let $=null,H=0;const bt=Math.floor(Math.random()*100)+1;for(const[ut,mt]of Object.entries(ct))if(H+=mt,bt<=H){$=ut;break}this.items.push(new xt(h.cx-Math.floor(U/2),h.y,$,U,U))}break}}if(r)return!0}),this.blocks=this.blocks.filter(function(h){return h.exist||h.remove(),h.exist}),[r,t,s,e,o,n]}collideItem(t){let s=!0;const e=t.y+t.speed;if(e>l(this,T)+t.h)s=!1;else{const o=Math.abs(t.cx-this.bar.cx),n=Math.abs(e+t.h/2-this.bar.cy);o<t.w/2+this.bar.w/2&&n<t.h/2+this.bar.h/2&&(s=!1,this.changeItem(t.type))}return[s,e]}changeItem(t){switch(t){case O.SPEEDUP:this.balls.forEach(function(o){o.speed<q&&(o.speed+=X,o.speed=o.speed>q?q:o.speed)});break;case O.SPEEDDOWN:this.balls.forEach(function(o){o.speed>tt&&(o.speed-=X,o.speed=o.speed<tt?tt:o.speed)});break;case O.WIDE:if(this.bar.mag<Z[Z.length-1]){this.blocks.forEach(n=>{n.type===c.BARRIER&&(n.exist=!1)});let o=Z.indexOf(this.bar.mag);o=o===-1?0:o+1,this.bar.wide(Z[o])}break;case O.BARRIER:let s=this.blocks.filter(o=>o.type===c.BARRIER).length;if(s<3){this.bar.wide(1);const o=5;this.blocks.push(new g(0,this.bar.y+this.bar.h+30+(2-s)*o,c.BARRIER,l(this,P)+100,o,s))}break;case O.SPLIT:const e=this.bar.cx<l(this,P)/2?315:225;this.balls.push(new et(this.bar.cx,this.bar.cy,e));break}}}P=new WeakMap,T=new WeakMap,new yt().start()})();
